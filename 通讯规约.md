# 通讯API

## enum code
* UNKNOWN_ERROR(-1,"未知错误"),
* REGISTER(0, "注册),
* SUCCESS(200, "开机注册成功"),
* OPERATION_READY(151,"准备要开始新的手术，获取opn"),
* OPERATION_READY_SUCCESS(152,"服务器准备完毕，可以开始手术了"),
* PATIENT_INFO_READY(153,"准备上传病人数据"),
* PATIENT_INFO_READY_SUCCESS(154, "可以开始上传病人数据"),
* PATIENT_INFO(155,"是病人数据"),
* PATIENT_INFO_END(156,"病人信息发送完毕"),
* PATIENT_INFO_END_SUCCESS(157,"病人信息发送完毕"),
* DEVICE_DATA_READY(158, "准备发送仪器数据"),
* DEVICE_DATA_READY_SUCCESS(159, "可以开始上传仪器数据"),
* DEVICE_DATA(160, "是仪器数据"),
* DEVICE_DATA_END(161,"病人信息发送完毕"),
* DEVICE_DATA_END_SUCCESS(162,"病人信息发送完毕"),

## Topic规则
* 采集器设备信息上传
```
Topic:/medical/sys/E0D55E227B92/event/update
```
* 病人身份上传
```
Topic:/medical/data/E0D55E227B92/patient/post
```
* 仪器输出信息上传
```
Topic:/medical/data/E0D55E227B92/device/post
```

## 发布规则
### 1. 所有设备开机时在公共`Topic:`发布自己的机器`Topic`
```
{
    "code": 0,
    "meg": {
        "mac": "mac",
    }
}
```
### 2. 服务器将会在公共`Topic`,上回复
```
{
    "code": 200,
    "meg": {
        "mac": "mac",
    }
}
```
### 3. 服务器订阅上述3个Topic


* #### 准备要数据(手术开始准备,请求opn)上传了`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 151,
    "meg": {}
}
```

* #### 服务器也准备完毕，返回opn，可以上传了`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 152
    "msg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 准备发送病人信息数据`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 153,
    "meg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 可以上传病人数据数据`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 154,
    "meg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 上传病人数据`Topic:/medical/data/E0D55E227B92/patient/post`
```
{
    "code": 155,
    "meg": {
        "mac": "mac",
        "opn": "opn",       
        "patientInfo": {
            "patientId": "value",
            "patientData": "value"
        }
    }
}
```

* #### 发布病人信息发送结束`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 156,
    "meg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 回复收到病人信息发送结束`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 157,
    "meg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 准备发送仪器数`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 158,
    "meg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 可以发送仪器数据`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 159,
    "msg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```

* #### 发送仪器数据`Topic:/medical/data/E0D55E227B92/device/post`
```
{
    "code": 160,
    "meg": {
        "mac": "mac",
        "opn": "opn",
        "data": {
            "deviceId": "value",
            "deviceData": "value"
        }
    }
}
```

* #### 仪器数据发送结束`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 161,
    "meg": {  
        "mac": "mac",
        "opn": "opn"
    }
}
```
* #### 回复收到医疗仪器数据结束信号`Topic:/medical/sys/E0D55E227B92/event/update`
```
{
    "code": 162,
    "msg": {
        "mac": "mac",
        "opn": "opn"
    }
}
```